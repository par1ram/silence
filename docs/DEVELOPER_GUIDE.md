# Гайд для разработчиков - Silence VPN

## 1. Архитектура

### Обзор
Silence VPN — это микросервисная система, написанная на Go. Каждый сервис работает в своем Docker-контейнере и выполняет определенную функцию.

### Структура сервиса
Каждый сервис имеет стандартизированную структуру:
```
service/
├── cmd/main.go           # Точка входа
├── internal/             # Внутренняя логика
│   ├── adapters/         # Адаптеры к внешним системам (БД, HTTP)
│   ├── app/              # Конфигурация и DI
│   ├── domain/           # Доменные модели и интерфейсы репозиториев
│   ├── ports/            # Интерфейсы для бизнес-логики
│   └── services/         # Реализация бизнес-логики
├── etc/                  # Файлы конфигурации
└── go.mod
```

### Взаимодействие между сервисами
- **HTTP API**: Основной способ синхронного взаимодействия.
- **RabbitMQ**: Для асинхронных уведомлений через сервис Notifications.
- **gRPC**: Используется в VPN Core для внутреннего взаимодействия.

## 2. Начало работы

### Требования
- Go 1.23+
- Docker & Docker Compose
- Task (https://taskfile.dev)

### Установка и запуск
1.  **Клонировать репозиторий**
    ```bash
    git clone <repository-url>
    cd silence
    ```
2.  **Установить зависимости**
    ```bash
    go mod download
    ```
3.  **Запустить инфраструктуру**
    ```bash
    docker-compose up -d
    ```
4.  **Собрать и запустить все сервисы**
    ```bash
    task build:all
    task dev:all
    ```

## 3. Процесс разработки

1.  **Создайте ветку**
    ```bash
    git checkout -b feature/my-new-feature
    ```
2.  **Определите домен** (`internal/domain`)
3.  **Реализуйте бизнес-логику** (`internal/services`)
4.  **Создайте адаптеры** (`internal/adapters`) для HTTP, базы данных и т.д.
5.  **Напишите тесты** (Unit и интеграционные)
6.  **Обновите документацию** (`API_REFERENCE.md`)

## 4. Конфигурация

- **`.env`**: Основной файл для переменных окружения.
- **`etc/config.env`**: Конфигурация для каждого конкретного сервиса.
- **`deployments/docker/init.sql`**: Скрипт инициализации базы данных.

## 5. CI/CD

Проект использует GitHub Actions для автоматизации.

- **`ci.yml`**: Линтинг, тесты, сборка Docker-образов и деплой.
- **`security.yml`**: Сканирование уязвимостей, зависимостей и секретов.
- **`release.yml`**: Создание релизов и публикация артефактов.

### Развертывание
- **Staging**: Автоматический деплой из ветки `develop`.
- **Production**: Автоматический деплой из ветки `main`.
- **Kubernetes**: Поддерживается развертывание в Kubernetes, см. `deployments/kubernetes`.

## 6. Отладка и мониторинг

- **Логи**: Все сервисы пишут структурированные логи в JSON формате.
- **Health Checks**: Каждый сервис имеет эндпоинт `/health`.
- **Метрики**: Сервис `Analytics` собирает метрики со всей системы.
- **Скрипты**: Используйте `manage.sh` для общих задач (статус, логи, рестарт).

## 7. Безопасность

- **Аутентификация**: JWT-токены для защиты API.
- **Шифрование**: Bcrypt для паролей, TLS для соединений.
- **Изоляция**: Сетевые политики в Docker и Kubernetes.
- **Сканирование**: Автоматические проверки безопасности в CI/CD.
